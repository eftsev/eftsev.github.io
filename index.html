<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">

        <!-- Import the component -->
        <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #slider-container {
            position: absolute; /* Ensure it stays in place */
            z-index: 1000; /* Bring it to the front */
            margin: 10px; /* Spacing around the slider */
            background-color: rgba(255, 255, 255, 0.8); /* Optional: Background for visibility */
            padding: 10px; /* Optional: Padding for aesthetics */
            border-radius: 5px; /* Optional: Rounded corners */
            width: 220px;
            height: 22px;
	}
        /* Style for the year label */
        #year-label {
            font-family: 'Arial', sans-serif; /* Change this to your desired font */
            font-size: 16px; /* Adjust the font size as needed */
            font-weight: bold; /* Make it bold if you want */
            color: #333; /* Change text color if desired */
       }
        /* Style for the label containing the word "Year" */
        #slider-container label {
            font-family: 'Arial', sans-serif; /* Change this to your desired font */
            font-size: 16px; /* Adjust the font size as needed */
            font-weight: bold; /* Make it bold if you want */
            color: #333; /* Change text color if desired */
        }
    .legend {
        position: fixed; /* Ensure it stays in place */
        background-color: white;
	opacity: 0.80;
        padding: 10px;
        border-radius: 5px;
	box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        font-size: 14px;
        line-height: 18px;
        color: #555;
	left: 0px;
	top: 50px;
	width: 220px;
	height: 360px;

    }
    .legend i {
        width: 18px;
        height: 18px;
        float: left;
        margin-right: 8px;
        opacity: 1;
    }
    
    .leaflet-popup {
    background: #ffffff; /* White background */
    border: 1px solid #ccc; /* Light gray border */
    border-radius: 10px; /* Rounded corners */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Subtle shadow */
    font-family: 'Arial', sans-serif; /* Modern font */
    color: #333; /* Text color */
}

/* Customize the popup content */
.leaflet-popup-content {
    padding: 15px; /* Add padding inside the popup */
    font-size: 14px; /* Adjust font size */
    line-height: 1.5; /* Improve readability */
}

/* Customize the popup close button */
.leaflet-popup-close-button {
    color: #333; /* Close button color */
    font-size: 18px; /* Larger close button */
    font-weight: bold; /* Bold close button */
    text-shadow: none; /* Remove text shadow */
    opacity: 0.8; /* Slightly transparent */
}

.leaflet-popup-close-button:hover {
    color: #007bff; /* Change color on hover */
    opacity: 1; /* Fully opaque on hover */
}

/* Add custom styles for tables inside the popup */
.leaflet-popup-content table {
    width: 100%; /* Full width table */
    border-collapse: collapse; /* Remove gaps between cells */
}

.leaflet-popup-content th,
.leaflet-popup-content td {
    padding: 8px; /* Add padding to cells */
    text-align: left; /* Align text to the left */
    border-bottom: 1px solid #ddd; /* Add a light border between rows */
}

.leaflet-popup-content th {
    font-weight: bold; /* Bold headers */
    color: #555; /* Slightly darker text for headers */
}

.leaflet-popup-content img {
    max-width: 100%; /* Make images responsive */
    border-radius: 5px; /* Add rounded corners to images */
    margin-top: 10px; /* Add spacing above images */
}

.leaflet-popup-content video {
    border-radius: 5px; /* Add rounded corners to videos */
    margin-top: 10px; /* Add spacing above videos */
}
/* Ensure the table has no extra spacing */
table {
    width: 100%; /* Make the table take the full width */
    border-collapse: collapse; /* Prevent spacing between cells */
}

/* Ensure all table cells have consistent padding */
table td {
    padding: 10px;
    vertical-align: middle; /* Center content vertically */
}
/* Image Overlay */
.overlay {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9); /* Start slightly smaller */
    background: rgba(255, 255, 255, 0.95);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    z-index: 10000;
    max-width: 90%;
    max-height: 90%;
    text-align: center;
    opacity: 0; /* Start invisible */
    transition: opacity 0.5s ease, transform 0.5s ease; /* Smooth fade and scale */
}

/* Blur Overlay */
.blur-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: blur(10px);
    z-index: 9999;
    opacity: 0; /* Start invisible */
    transition: opacity 0.5s ease; /* Smooth fade */
}

/* Close Button */
.close-button {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    cursor: pointer;
    font-weight: bold;
    color: #333;
    transition: color 0.3s ease; /* Smooth hover effect */
}

.close-button:hover {
    color: #007bff; /* Change color on hover */
}

/* Overlay Image */
.overlay-image {
    max-width: 80vw;
    max-height: 90vh;
    border-radius: 5px;
}

/* 3D Model Overlay */
#model-overlay {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9); /* Start slightly smaller */
    background: rgba(255, 255, 255, 0.95);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    z-index: 10000;
    max-width: 90%;
    max-height: 90%;
    text-align: center;
    opacity: 0; /* Start invisible */
    transition: opacity 0.5s ease, transform 0.5s ease; /* Smooth fade and scale */
}

/* Blur Overlay */
.blur-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: blur(10px);
    z-index: 9999;
    opacity: 0; /* Start invisible */
    transition: opacity 0.5s ease; /* Smooth fade */
}

/* Close Button */
.close-button {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    cursor: pointer;
    font-weight: bold;
    color: #333;
    transition: color 0.3s ease; /* Smooth hover effect */
}

.close-button:hover {
    color: #007bff; /* Change color on hover */
}

/* Modern Button Styling */
.modern-button {
    display: inline-block;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(90deg, #007bff, #0056b3); /* Gradient background */
    border: none;
    border-radius: 25px; /* Rounded corners */
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
    transition: all 0.3s ease; /* Smooth hover effect */
}

.modern-button:hover {
    background: linear-gradient(90deg, #0056b3, #003f7f); /* Darker gradient on hover */
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2); /* Slightly larger shadow */
    transform: translateY(-2px); /* Lift the button slightly */
}

.modern-button:active {
    transform: translateY(0); /* Reset lift on click */
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2); /* Smaller shadow on click */
}

audio::-webkit-media-controls-panel {
    background-color: transparent !important; /* Make the background transparent */
    border: none !important; /* Remove any borders */
}

audio::-webkit-media-controls-enclosure {
    background-color: transparent !important; /* Make the enclosure transparent */
    border: none !important; /* Remove any borders */
}

audio {
    background-color: transparent !important; /* Ensure the audio element itself is transparent */
    border: none !important; /* Remove any borders */
    outline: none !important; /* Remove focus outline */
}

/* Invert the entire player for a dark theme */
.audio-player-inverted {
    filter: invert(1); /* Invert all colors */
}

        /* Styling for the container */
        .container {
            width: 500px;
            height: 250px;
            background-color: white; /* White background */
            border: none; /* Optional: Adds a black border around the container */
            position: fixed; /* Keeps it always visible */
            bottom: 0; /* Positions the container at the bottom of the page */
            margin-bottom: 15px; /* Positions the container at the bottom of the page */
            left: 0; /* Positions the container at the right of the page */
            margin-left: 15px; /* Positions the container at the bottom of the page */
            z-index: 1000; /* Ensures it stays on top of other elements */
            background-color: rgba(255, 255, 255, 0.8); /* Optional: Background for visibility */
            border-radius: 20px; /* Rounds the corners of the container */
            display: flex;
            justify-content: center; /* Center the chart horizontally */
            align-items: center; /* Center the chart vertically */
        }
        
/* Ensure the legend fits within the container */
.container .chartjs-legend {
    display: flex; /* Use flexbox for horizontal alignment */
    flex-wrap: nowrap; /* Prevent wrapping to the next line */
    justify-content: center; /* Center the legend items */
    margin-top: 10px; /* Add some spacing above the legend */
    font-size: 12px; /* Adjust font size for better fit */
    gap: 5px; /* Add spacing between legend items */
    overflow: hidden; /* Prevent overflow */
    white-space: nowrap; /* Prevent text wrapping */
}

/* For 1920x1200 screens */
@media (max-width: 1920px) and (max-height: 1200px) {
  body {
    transform: scale(0.75);
    transform-origin: top left;
    width: 133.33%;
    height: 133.33vh;
    overflow: hidden;
  }
}

/* For 1920x1080 screens */
@media (max-width: 1920px) and (max-height: 1080px) {
  body {
    transform: scale(0.75);
    transform-origin: top left;
    width: 133.33%;
    height: 133.33vh;
    overflow: hidden;
  }
}

/* For 1760x990 screens */
@media (max-width: 1760px) and (max-height: 990px) {
  body {
    transform: scale(0.7);
    transform-origin: top left;
    width: 142.85%;
    height: 142.85vh;
    overflow: hidden;
  }
}

/* For 1680x1050 screens */
@media (max-width: 1680px) and (max-height: 1050px) {
  body {
    transform: scale(0.7);
    transform-origin: top left;
    width: 142.85%;
    height: 142.85vh;
    overflow: hidden;
  }
}

/* For 1600x1200 screens */
@media (max-width: 1600px) and (max-height: 1200px) {
  body {
    transform: scale(0.65);
    transform-origin: top left;
    width: 153.85%;
    height: 153.85vh;
    overflow: hidden;
  }
}

/* For 1600x900 screens */
@media (max-width: 1600px) and (max-height: 900px) {
  body {
    transform: scale(0.65);
    transform-origin: top left;
    width: 153.85%;
    height: 153.85vh;
    overflow: hidden;
  }
}

/* For 1366x768 screens */
@media (max-width: 1366px) and (max-height: 768px) {
  body {
    transform: scale(0.6);
    transform-origin: top left;
    width: 166.66%;
    height: 166.66vh;
    overflow: hidden;
  }
}

/* For 1280x1024 screens */
@media (max-width: 1280px) and (max-height: 1024px) {
  body {
    transform: scale(0.55);
    transform-origin: top left;
    width: 181.81%;
    height: 181.81vh;
    overflow: hidden;
  }
}

/* For 1280x720 screens */
@media (max-width: 1280px) and (max-height: 720px) {
  body {
    transform: scale(0.55);
    transform-origin: top left;
    width: 181.81%;
    height: 181.81vh;
    overflow: hidden;
  }
}

/* For 1128x634 screens */
@media (max-width: 1128px) and (max-height: 634px) {
  body {
    transform: scale(0.5);
    transform-origin: top left;
    width: 200%;
    height: 200vh;
    overflow: hidden;
  }
}

/* For 1024x768 screens */
@media (max-width: 1024px) and (max-height: 768px) {
  body {
    transform: scale(0.45);
    transform-origin: top left;
    width: 222.22%;
    height: 222.22vh;
    overflow: hidden;
  }
}

/* For 800x600 screens */
@media (max-width: 800px) and (max-height: 600px) {
  body {
    transform: scale(0.35);
    transform-origin: top left;
    width: 285.71%;
    height: 285.71vh;
    overflow: hidden;
  }
}

</style>
<title>Χαρτογραφική Eφαρμογή</title>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcome-screen" style="
        position: fixed;
        font-family: sans-serif;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;">
        
        <h1 style="font-size: 2em; margin-bottom: 20px;">Καλώς Ορίσατε!</h1>
        <p style="font-size: 1.2em; margin-bottom: 30px; text-align: center;">Δοκιμαστική Λειτουργία Εφαρμογής για τη Μεταπτυχιακή Εργασία</p>
        <button id="welcome-button" style="
            padding: 10px 20px;
            font-size: 1em;
            background-color: #007bff;
            color: white;
            font-family: sans-serif;
            border: none;
            border-radius: 5px;
            cursor: pointer;">
            Είσοδος στην Εφαρμογή
        </button>
    </div>
    <!-- Empty container with the specified dimensions -->
    <div class="container">
        <canvas id="pieChart" width="300" height="300"></canvas>
    </div>

    <!-- Year Slider -->
    <div id="slider-container">
        <input type="range" id="year-slider" min="2001" max="2021" step="10" value="2001">
        <label for="year-slider">Year: <span id="year-label">2001</span></label>
    </div>

    <!-- Map Container -->
    <div id="map"></div>

<!-- Image Overlay -->
<div id="image-overlay" class="overlay">
    <span id="close-overlay" class="close-button">&times;</span>
    <img id="overlay-image" src="" class="overlay-image">
</div>

<!-- 3D Model Overlay -->
<div id="model-overlay" class="overlay">
    <span id="close-model-overlay" class="close-button">&times;</span>
    <model-viewer id="overlay-model-viewer" 
                  src="" 
                  camera-controls 
                  auto-rotate 
                  style="width: 80vw; height: 80vh;">
    </model-viewer>

</div>
<!-- Blurred Background -->
<div id="blur-overlay" class="blur-overlay">    
    
</div>

    <!-- Loading necessary Leaflet and related JS libraries -->
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
    <script src="js/leaflet-measure.js"></script>
    <script src="data/nomoi_1.js"></script>
    <script src="data/Fire_0.js"></script>
    <script src="data/Photo_0.js"></script>
    <script src="data/number2_0.js"></script>
        <!-- Import the component -->
        <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>

    <script>
    
        // Function to hide the welcome screen when the button is clicked
        document.getElementById('welcome-button').addEventListener('click', function () {
            const welcomeScreen = document.getElementById('welcome-screen');
            welcomeScreen.style.transition = 'opacity 0.5s';
            welcomeScreen.style.opacity = '0';
            setTimeout(() => {
                welcomeScreen.style.display = 'none';
            }, 500);
        });

        document.addEventListener("DOMContentLoaded", function () {
    // Initialize population counts for 2001 and 2011
    let lowPopulationCount2001 = 0;
    let mediumPopulationCount2001 = 0;
    let highPopulationCount2001 = 0;

    let lowPopulationCount2011 = 0;
    let mediumPopulationCount2011 = 0;
    let highPopulationCount2011 = 0;

    // Loop through the 'nomoi_1' GeoJSON features to calculate counts for 2001
    json_nomoi_1.features.forEach((feature) => {
        const population = feature.properties.population; // Access the population data
        if (population < 100000) {
            lowPopulationCount2001++;
        } else if (population < 500000) {
            mediumPopulationCount2001++;
        } else {
            highPopulationCount2001++;
        }
    });

    // Loop through the 'number2_0' GeoJSON features to calculate counts for 2011
    json_number2_0.features.forEach((feature) => {
        const population = feature.properties.population; // Access the population data
        if (population < 50000) {
            lowPopulationCount2011++;
        } else if (population < 200000) {
            mediumPopulationCount2011++;
        } else {
            highPopulationCount2011++;
        }
    });

    // Get the canvas element
    const ctx = document.getElementById('pieChart').getContext('2d');

    // Create the Pie Chart
    const pieChart = new Chart(ctx, {
        type: 'pie', // Chart type
        data: {
            labels: ['< 100,000', '100,000 - 500,000', '> 500,000'], // Initial labels for 2001
            datasets: [{
                label: 'Number of Regions', // Dataset label
                data: [lowPopulationCount2001, mediumPopulationCount2001, highPopulationCount2001], // Initial data (2001)
                backgroundColor: [ // Colors for each section
                    'rgba(255,53,53,0.6)', // Low population color
                    'rgba(53,255,107,0.6)', // Medium population color
                    'rgba(83,240,252,0.6)', // High population color
                ],
                borderColor: [ // Border colors
                    'rgba(255,53,53,1)',
                    'rgba(53,255,107,1)',
                    'rgba(83,240,252,1)',
                ],
                borderWidth: 1 // Border width
            }]
        },
        options: {
            responsive: true, // Make the chart responsive
            plugins: {
                legend: {
                    position: 'bottom', // Position the legend at the bottom
                    labels: {
                        boxWidth: 15, // Adjust the size of the color box
                        padding: 10, // Add padding between legend items
                        usePointStyle: true, // Use points instead of squares
                        font: {
                            size: 12, // Adjust font size for better fit
                        },
                        generateLabels: function (chart) {
                            // Always display Low, Medium, High in the legend
                            return [
                                {
                                    text: 'Low',
                                    fillStyle: 'rgba(255,53,53,0.6)',
                                    strokeStyle: 'rgba(255,53,53,1)',
                                    lineWidth: 1,
                                },
                                {
                                    text: 'Medium',
                                    fillStyle: 'rgba(53,255,107,0.6)',
                                    strokeStyle: 'rgba(53,255,107,1)',
                                    lineWidth: 1,
                                },
                                {
                                    text: 'High',
                                    fillStyle: 'rgba(83,240,252,0.6)',
                                    strokeStyle: 'rgba(83,240,252,1)',
                                    lineWidth: 1,
                                },
                            ];
                        },
                    },
                },
                tooltip: {
                    enabled: true, // Enable tooltips
                },
            },
            layout: {
                padding: {
                    top: 10, // Add padding above the chart
                    bottom: 10, // Add padding below the chart
                },
            },
        },
    });

    // Function to update the pie chart based on the year
    function updatePieChart(year) {
        if (year == 2001) {
            // Update the chart data and labels for 2001
            pieChart.data.datasets[0].data = [lowPopulationCount2001, mediumPopulationCount2001, highPopulationCount2001];
            pieChart.data.labels = ['< 100,000', '100,000 - 500,000', '> 500,000']; // Labels for 2001
        } else if (year == 2011) {
            // Update the chart data and labels for 2011
            pieChart.data.datasets[0].data = [lowPopulationCount2011, mediumPopulationCount2011, highPopulationCount2011];
            pieChart.data.labels = ['< 50,000', '50,000 - 200,000', '> 200,000']; // Labels for 2011
        }

        // Refresh the chart
        pieChart.update();
    }

    // Add an event listener to the slider
    document.getElementById('year-slider').addEventListener('input', function () {
        const year = parseInt(this.value); // Get the current slider value (year)
        updatePieChart(year); // Update the pie chart based on the year
    });
});

// Function to show the image overlay
function showImageOverlay(imageSrc) {
    const imageOverlay = document.getElementById('image-overlay');
    const blurOverlay = document.getElementById('blur-overlay');

    // Set the image source
    document.getElementById('overlay-image').src = imageSrc;

    // Display the overlays
    imageOverlay.style.display = 'block';
    blurOverlay.style.display = 'block';

    // Trigger the transition by changing opacity and transform
    setTimeout(() => {
        imageOverlay.style.opacity = '1';
        imageOverlay.style.transform = 'translate(-50%, -50%) scale(1)'; // Scale to normal size
        blurOverlay.style.opacity = '1';
    }, 10); // Small delay to ensure the transition is applied
}

// Close the overlay when clicking the close button
document.getElementById('close-overlay').addEventListener('click', function () {
    const imageOverlay = document.getElementById('image-overlay');
    const blurOverlay = document.getElementById('blur-overlay');

    // Trigger the transition by changing opacity and transform
    imageOverlay.style.opacity = '0';
    imageOverlay.style.transform = 'translate(-50%, -50%) scale(0.9)'; // Scale down
    blurOverlay.style.opacity = '0';

    // Hide the overlays after the transition ends
    setTimeout(() => {
        imageOverlay.style.display = 'none';
        blurOverlay.style.display = 'none';
    }, 500); // Match the duration of the CSS transition
});

// Close the overlay if clicking outside the image (on the blurred area)
document.getElementById('image-overlay').addEventListener('click', function (event) {
    if (event.target === this) {  // If the background (outside the image) is clicked
        closeOverlay();
    }
});

// Close the overlay if clicking on the blurred area
document.getElementById('blur-overlay').addEventListener('click', function () {
    closeOverlay();
});

// Close the overlay if pressing the Escape key
document.addEventListener('keydown', function (event) {
    if (event.key === 'Escape') {  // If the Escape key is pressed
        closeOverlay();
    }
});

// Function to close the overlay with smooth transition
function closeOverlay() {
    const imageOverlay = document.getElementById('image-overlay');
    const blurOverlay = document.getElementById('blur-overlay');

    // Trigger the transition by changing opacity and transform
    imageOverlay.style.opacity = '0';
    imageOverlay.style.transform = 'translate(-50%, -50%) scale(0.9)'; // Scale down
    blurOverlay.style.opacity = '0';

    // Hide the overlays after the transition ends
    setTimeout(() => {
        imageOverlay.style.display = 'none';
        blurOverlay.style.display = 'none';
    }, 500); // Match the duration of the CSS transition
}

// Function to show the 3D model overlay
function showModelOverlay(modelSrc) {
    const modelOverlay = document.getElementById('model-overlay');
    const modelViewer = document.getElementById('overlay-model-viewer');
    const blurOverlay = document.getElementById('blur-overlay');

    // Set the model source
    modelViewer.src = modelSrc;

    // Display the overlays
    modelOverlay.style.display = 'block';
    blurOverlay.style.display = 'block';

    // Trigger the transition by changing opacity and transform
    setTimeout(() => {
        modelOverlay.style.opacity = '1';
        modelOverlay.style.transform = 'translate(-50%, -50%) scale(1)'; // Scale to normal size
        blurOverlay.style.opacity = '1';
    }, 10); // Small delay to ensure the transition is applied
}

// Function to close the 3D model overlay
function closeModelOverlay() {
    const modelOverlay = document.getElementById('model-overlay');
    const blurOverlay = document.getElementById('blur-overlay');

    // Trigger the transition by changing opacity and transform
    modelOverlay.style.opacity = '0';
    modelOverlay.style.transform = 'translate(-50%, -50%) scale(0.9)'; // Scale down
    blurOverlay.style.opacity = '0';

    // Hide the overlays after the transition ends
    setTimeout(() => {
        modelOverlay.style.display = 'none';
        blurOverlay.style.display = 'none';
    }, 500); // Match the duration of the CSS transition
}

// Close the overlay when clicking the close button
document.getElementById('close-model-overlay').addEventListener('click', closeModelOverlay);

// Close the overlay if clicking outside the model viewer
document.getElementById('model-overlay').addEventListener('click', function (event) {
    if (event.target === this) {
        closeModelOverlay();
    }
});

// Close the 3D model overlay if clicking on the blurred area
document.getElementById('blur-overlay').addEventListener('click', function () {
    closeModelOverlay();
});

// Close the overlay if pressing the Escape key
document.addEventListener('keydown', function (event) {
    if (event.key === 'Escape') {
        closeModelOverlay();
    }
});

        // Function to update the year label based on the slider value
        function updateYearLabel() {
            const slider = document.getElementById('year-slider');
            const yearLabel = document.getElementById('year-label'); // ID of the year label
            yearLabel.textContent = slider.value; // Update the year label text
        }

        // Add an event listener to the slider to call updateYearLabel on input
        document.getElementById('year-slider').addEventListener('input', updateYearLabel);

        // Initial call to set the label correctly on page load
        updateYearLabel(); // Call this function to set initial value

// Function to handle the slider change event
document.getElementById('year-slider').addEventListener('input', function () {
    const year = this.value; // Get the current slider value (year)

    // Update the year label
    document.getElementById('year-label').textContent = year;

    // Toggle layers based on the slider value
    if (year == 2001) {
        if (!map.hasLayer(layer_nomoi_1)) {
            map.addLayer(layer_nomoi_1); // Add the 2001 layer
        }
        if (map.hasLayer(layer_number2_0)) {
            map.removeLayer(layer_number2_0); // Remove the 2011 layer
        }
    } else if (year == 2011) {
        if (!map.hasLayer(layer_number2_0)) {
            map.addLayer(layer_number2_0); // Add the 2011 layer
        }
        if (map.hasLayer(layer_nomoi_1)) {
            map.removeLayer(layer_nomoi_1); // Remove the 2001 layer
        }
    }

    function bindPopupsToActiveLayer(year) {
    if (year == 2001) {
        layer_nomoi_1.eachLayer(function (layer) {
            const popupContent = '<table>\
                <tr><th>Region</th><td>' + (layer.feature.properties['Nomoi'] || 'N/A') + '</td></tr>\
                <tr><th>Population</th><td>' + (layer.feature.properties['population'] || 'N/A') + '</td></tr>\
                <tr><th>Area (km²)</th><td>' + (layer.feature.properties['area_km2'] || 'N/A') + '</td></tr>\
            </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        });
    } else if (year == 2011) {
        layer_number2_0.eachLayer(function (layer) {
            const popupContent = '<table>\
                <tr><th>Region</th><td>' + (layer.feature.properties['Nomoi'] || 'N/A') + '</td></tr>\
                <tr><th>Population</th><td>' + (layer.feature.properties['population'] || 'N/A') + '</td></tr>\
                <tr><th>Density</th><td>' + (layer.feature.properties['pop_densit'] || 'N/A') + '</td></tr>\
            </table>';
            layer.bindPopup(popupContent, { maxHeight: 400 });
        });
    }
}

});



        var highlightLayer;
var soundA = new Audio('sounds/soundA.wav');  // Define soundA
var soundB = new Audio('sounds/soundB.wav');  // Define soundB
var soundC = new Audio('sounds/soundC.wav');  // Define soundC
var soundD = new Audio('sounds/soundD.wav');  // Define soundD

var colorSoundMapping = {
    'rgba(255,53,53,0.6)': soundA, // Low population color (Red)
    'rgba(53,255,107,0.6)': soundB, // Medium population color (Green)
    'rgba(83,240,252,0.6)': soundC    // High population color (Blue)
};

// Function to highlight the feature and play sound based on its color
function highlightFeature(e) {
    highlightLayer = e.target;

    // Determine the current color
    var fillColor = highlightLayer.options.fillColor; // Get the fill color of the polygon

    // Set the highlight color
    if (highlightLayer.feature.geometry.type === 'LineString' || highlightLayer.feature.geometry.type === 'MultiLineString') {
        highlightLayer.setStyle({
            color: '#ffff00' // Highlight color for line features
        });
    } else {
        highlightLayer.setStyle({
            fillColor: '#ffff00', // Set highlight color for polygons
            fillOpacity: 1
        });
    }

    // Play the corresponding sound based on the current fill color
    var soundToPlay = colorSoundMapping[fillColor];
    if (soundToPlay) {
        soundToPlay.play();
    }
}

// Function to reset highlight
function resetHighlight(e) {
    if (e.target.resetStyle) {
        e.target.resetStyle(); // Reset style to default when mouse leaves
    }
}

        // Initialize the Leaflet map, setting initial bounds and zoom levels
        var map = L.map('map', {
            zoomControl: false, // Disable the default zoom control
            maxZoom: 28, // Max zoom level
            minZoom: 1 // Min zoom level
        }).setView([38.260, 24.280], 7); // Set initial bounds

// Ensure the map resets to the initial location and zoom level on load
map.on('load', function () {
    map.setView([38.260, 24.280], 7); // Reset to the desired location and zoom level
});

// Optional: Reset the map view when the page is refreshed
window.addEventListener('load', function () {
    map.setView([38.260, 24.280], 7); // Reset to the desired location and zoom level
});

        var hash = new L.Hash(map); // Add URL hash based on map state

        // Set map attribution (credits for the technologies used)
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');

        var autolinker = new Autolinker({ truncate: { length: 30, location: 'smart' }}); // Auto-link URLs in popup content

        // Function to remove empty rows from popups
        function removeEmptyRowsFromPopupContent(content, feature) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var rows = tempDiv.querySelectorAll('tr');
            for (var i = 0; i < rows.length; i++) {
                var td = rows[i].querySelector('td.visible-with-data');
                var key = td ? td.id : '';
                if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                    rows[i].parentNode.removeChild(rows[i]); // Remove rows with no data
                }
            }
            return tempDiv.innerHTML; // Return updated content
        }

        // Function to add a class to the popup if it contains media (like an image)
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            if (tempDiv.querySelector('td img')) {
                popup._contentNode.classList.add('media'); // Add class if it has media
                setTimeout(function() { popup.update(); }, 10); // Force popup redraw
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
    
var legend2001 = L.control({ position: 'topleft' });
var legend2011 = L.control({ position: 'topleft' });

// Function to create the legend for 2001
legend2001.onAdd = function(map) {
    var div = L.DomUtil.create('div', 'legend');
    div.innerHTML = `
        <b style="font-size: 20px; margin-bottom: 22px; margin-top: 8px; opacity: 1; display: block;">Legend</b>
        <b style="font-size: 15px; margin-bottom: 10px; margin-top: 8px; opacity: 1; display: block;">Population</b>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(255,53,53,0.6); width: 18px; height: 18px; display: inline-block; margin-left: 12.5px;"></i>
            <span style="margin-left: 20px;">&lt; 100,000</span>
        </div>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(53,255,107,0.6); width: 18px; height: 18px; display: inline-block; margin-left: 12.5px;"></i>
            <span style="margin-left: 20px;">100,000 - 500,000</span>
        </div>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(83,240,252,0.6); width: 18px; height: 18px; display: inline-block; margin-left: 12.5px;"></i>
            <span style="margin-left: 20px;">&gt; 500,000</span>
        </div>
        <b style="font-size: 15px; margin-bottom: 10px; margin-top: 8px; opacity: 1; display: block;">Photo</b>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: url(markers/Photo_1.svg); background-size: contain; width: 18px; height: 18px; display: inline-block; margin-left: 12.5px;"></i>
            <span style="margin-left: 20px;">Photo Locations</span>
        </div>
        <b style="font-size: 15px; margin-bottom: 10px; margin-top: 8px; opacity: 1; display: block;">Fire Severity</b>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(235,178,72,1.0); width: 15px; height: 15px; display: inline-block; border-radius: 50%; margin-left: 14px;"></i>
            <span style="margin-left: 20px;">Low</span>
        </div>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(220,109,69,1.0); width: 30px; height: 30px; display: inline-block; border-radius: 50%; margin-left: 7px;"></i>
            <span style="margin-left: 10px;">Medium</span>
        </div>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(199,0,0,1.0); width: 45px; height: 45px; display: inline-block; border-radius: 50%; margin-left: 0px;"></i>
            <span style="margin-left: 5px;">High</span>
        </div>`;
    return div;
};

// Function to create the legend for 2011
legend2011.onAdd = function(map) {
    var div = L.DomUtil.create('div', 'legend');
    div.innerHTML = `
        <b style="font-size: 20px; margin-bottom: 22px; margin-top: 8px; opacity: 1; display: block;">Legend</b>
        <b style="font-size: 15px; margin-bottom: 10px; margin-top: 8px; opacity: 1; display: block;">Population</b>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(255,53,53,0.6); width: 18px; height: 18px; display: inline-block; margin-left: 12.5px;"></i>
            <span style="margin-left: 20px;">&lt; 50,000</span>
        </div>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(53,255,107,0.6); width: 18px; height: 18px; display: inline-block; margin-left: 12.5px;"></i>
            <span style="margin-left: 20px;">50,000 - 200,000</span>
        </div>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(83,240,252,0.6); width: 18px; height: 18px; display: inline-block; margin-left: 12.5px;"></i>
            <span style="margin-left: 20px;">&gt; 200,000</span>
        </div>
        <b style="font-size: 15px; margin-bottom: 10px; margin-top: 8px; opacity: 1; display: block;">Photo</b>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: url(markers/Photo_1.svg); background-size: contain; width: 18px; height: 18px; display: inline-block; margin-left: 12.5px;"></i>
            <span style="margin-left: 20px;">Photo Locations</span>
        </div>
        <b style="font-size: 15px; margin-bottom: 10px; margin-top: 8px; opacity: 1; display: block;">Fire Severity</b>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(235,178,72,1.0); width: 15px; height: 15px; display: inline-block; border-radius: 50%; margin-left: 14px;"></i>
            <span style="margin-left: 20px;">Low</span>
        </div>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(220,109,69,1.0); width: 30px; height: 30px; display: inline-block; border-radius: 50%; margin-left: 7px;"></i>
            <span style="margin-left: 10px;">Medium</span>
        </div>
        <div style="margin-bottom: 10px; display: flex; align-items: center;">
            <i style="background: rgba(199,0,0,1.0); width: 45px; height: 45px; display: inline-block; border-radius: 50%; margin-left: 0px;"></i>
            <span style="margin-left: 5px;">High</span>
        </div>`;
    return div;
};

// Add the legends to the map
legend2001.addTo(map);
legend2011.addTo(map);

function toggleLegends(year) {
    if (year === '2001') {
        map.addControl(legend2001);
        map.removeControl(legend2011);
    } else if (year === '2011') {
        map.addControl(legend2011);
        map.removeControl(legend2001);
    }
}

        // Adding zoom control to the map at the top left
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);

	document.querySelector('.leaflet-control-zoom').style.marginTop = '10px'; // Adjust this value as needed
	document.querySelector('.leaflet-control-zoom').style.marginLeft = '260px'; // Adjust this value as needed
        // Adding search/geocoder control to the map
        var osmGeocoder = new L.Control.Geocoder({
            collapsed: true, // Collapsed by default
            position: 'topleft',
            text: 'Search',
            title: 'Testing'
        }).addTo(map);

	document.querySelector('.leaflet-control-geocoder').style.marginTop = '10px'; // Adjust this value as needed
    document.querySelector('.leaflet-control-geocoder').style.marginLeft = '260px'; // Adjust this value as needed

        // Customize the search icon and tooltip
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0].className += ' fa fa-search';
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0].title += 'Search for a place';

        // Adding a measure control tool for distances and areas
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'

        });
        measureControl.addTo(map);

        document.querySelector('.leaflet-control-measure').style.marginTop = '10px'; // Adjust this value as needed
        document.querySelector('.leaflet-control-measure').style.marginLeft = '260px'; // Adjust this value as needed

        // Customizing the appearance of the measure tool button
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';

        var bounds_group = new L.featureGroup([]); // Group to manage feature bounds

        function setBounds() {
            // Function to adjust map bounds if needed
        }

// Call this function whenever the year changes
document.getElementById('year-slider').addEventListener('input', function(event) {
    year = event.target.value; // Assuming this returns '2001' or '2011'
    toggleLegends(year); // Toggle legends based on the new year
});

// Set the initial year and toggle the legends
var year = '2001'; // or however you determine the initial year
toggleLegends(year);

// Function to create popups for 'nomoi' features with customized content
function pop_nomoi_1(feature, layer) {
    layer.on({
        mouseout: function(e) {
            // Reset style when mouse leaves
            for (var i in e.target._eventParents) {
                if (typeof e.target._eventParents[i].resetStyle === 'function') {
                    e.target._eventParents[i].resetStyle(e.target);
                }
            }

            // Get the original fill color before highlight
            var originalFillColor = layer.options.fillColor;

            // Stop and reset the corresponding sound based on the original fill color
            var soundToStop = colorSoundMapping[originalFillColor];
            if (soundToStop) {
                soundToStop.pause(); // Stop the sound
                soundToStop.currentTime = 0; // Reset the sound
            }
        },
        mouseover: highlightFeature, // Call highlightFeature on mouseover
    });


            // Popup content based on feature properties
            var popupContent = '<table>\
    <tr>\
        <th scope="row">Prefecture (GR)</th>\
        <td class="visible-with-data" id="Perifer_GR">' + (feature.properties['Perifer_GR'] !== null ? autolinker.link(feature.properties['Perifer_GR'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Region (GR)</th>\
        <td class="visible-with-data" id="Nomoi_GR">' + (feature.properties['Nomoi_GR'] !== null ? autolinker.link(feature.properties['Nomoi_GR'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Prefecture</th>\
        <td class="visible-with-data" id="Perifer">' + (feature.properties['Perifer'] !== null ? autolinker.link(feature.properties['Perifer'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Region</th>\
        <td class="visible-with-data" id="Nomoi">' + (feature.properties['Nomoi'] !== null ? autolinker.link(feature.properties['Nomoi'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Population</th>\
        <td class="visible-with-data" id="population">' + (feature.properties['population'] !== null ? autolinker.link(feature.properties['population'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Area (km²)</th>\
        <td class="visible-with-data" id="area_km2">' + (feature.properties['area_km2'] !== null ? autolinker.link(feature.properties['area_km2'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Population Density</th>\
        <td class="visible-with-data" id="pop_densit">' + (feature.properties['pop_densit'] !== null ? autolinker.link(feature.properties['pop_densit'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
</table>';

            var content = removeEmptyRowsFromPopupContent(popupContent, feature); // Clean empty rows
            layer.on('popupopen', function(e) {
                addClassToPopupIfMedia(content, e.popup); // Add class for media
            });
            layer.bindPopup(content, { maxHeight: 400 }); // Bind the popup to the layer
            
        }

        // Style function to define visual properties of 'nomoi' features
        function style_nomoi_1_0(feature) {
            let fillColor;

            // Example: Change color based on the 'population' property
            const population = feature.properties.population; // Access the population data
            if (population < 100000) {
                fillColor = 'rgba(255,53,53,0.6)'; // Low population color
            } else if (population < 500000) {
                fillColor = 'rgba(53,255,107,0.6)'; // Medium population color
            } else {
                fillColor = 'rgba(83,240,252,0.6)'; // High population color
            }

            return {
                pane: 'pane_nomoi_1', // Add to a specific pane
                opacity: 1,
                color: 'rgba(35,35,35,1.0)', // Border color
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, // Border weight
                fill: true,
                fillOpacity: 1,
                fillColor: fillColor, // Fill color based on population
                interactive: true, // Allow interactions
            };
        }

        // Create a pane for 'nomoi' features and add it to the map
        map.createPane('pane_nomoi_1');
        map.getPane('pane_nomoi_1').style.zIndex = 201;
        map.getPane('pane_nomoi_1').style['mix-blend-mode'] = 'normal';

        // Add 'nomoi' GeoJSON layer with styles and popups
        var layer_nomoi_1 = new L.geoJson(json_nomoi_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_nomoi_1',
            layerName: 'layer_nomoi_1',
            pane: 'pane_nomoi_1',
            onEachFeature: pop_nomoi_1, // Add popups
            style: style_nomoi_1_0, // Apply styling
        });

// Add the layer to the bounds group
bounds_group.addLayer(layer_nomoi_1);

// Initial check to ensure the layer is managed correctly based on the slider's current value
const initialYear = document.getElementById('year-slider').value; // Get the current slider value
if (initialYear == 2001) {
    map.addLayer(layer_nomoi_1); // Add the layer if the current slider value is 2001
} else {
    map.removeLayer(layer_nomoi_1); // Remove the layer if the current slider value is not 2001
}	


// Function to create popups for 'nomoi' features with customized content
function pop_number2_0(feature, layer) {
    layer.on({
        mouseout: function(e) {
            // Reset style when mouse leaves
            for (var i in e.target._eventParents) {
                if (typeof e.target._eventParents[i].resetStyle === 'function') {
                    e.target._eventParents[i].resetStyle(e.target);
                }
            }

            // Get the original fill color before highlight
            var originalFillColor = layer.options.fillColor;

            // Stop and reset the corresponding sound based on the original fill color
            var soundToStop = colorSoundMapping[originalFillColor];
            if (soundToStop) {
                soundToStop.pause(); // Stop the sound
                soundToStop.currentTime = 0; // Reset the sound
            }
        },
        mouseover: highlightFeature, // Call highlightFeature on mouseover
    });

    var popupContent = '<table>\
    <tr>\
        <th scope="row">Prefecture (GR)</th>\
        <td class="visible-with-data" id="Perifer_GR">' + (feature.properties['Perifer_GR'] !== null ? autolinker.link(feature.properties['Perifer_GR'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Region (GR)</th>\
        <td class="visible-with-data" id="Nomoi_GR">' + (feature.properties['Nomoi_GR'] !== null ? autolinker.link(feature.properties['Nomoi_GR'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Prefecture</th>\
        <td class="visible-with-data" id="Perifer">' + (feature.properties['Perifer'] !== null ? autolinker.link(feature.properties['Perifer'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Region</th>\
        <td class="visible-with-data" id="Nomoi">' + (feature.properties['Nomoi'] !== null ? autolinker.link(feature.properties['Nomoi'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Population</th>\
        <td class="visible-with-data" id="population">' + (feature.properties['population'] !== null ? autolinker.link(feature.properties['population'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Area (km²)</th>\
        <td class="visible-with-data" id="area_km2">' + (feature.properties['area_km2'] !== null ? autolinker.link(feature.properties['area_km2'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
    <tr>\
        <th scope="row">Population Density</th>\
        <td class="visible-with-data" id="pop_densit">' + (feature.properties['pop_densit'] !== null ? autolinker.link(feature.properties['pop_densit'].toLocaleString()) : 'N/A') + '</td>\
    </tr>\
</table>';

                
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
            
        }

        // Style function to define visual properties of 'nomoi' features
        function style_number2_0(feature) {
            let fillColor;

            // Example: Change color based on the 'population' property
            const population = feature.properties.population; // Access the population data
            if (population < 50000) {
                fillColor = 'rgba(255,53,53,0.6)'; // Low population color
            } else if (population < 200000 && population >= 50000) {
                fillColor = 'rgba(53,255,107,0.6)'; // Medium population color
            } else if (population >= 200000) {
                fillColor = 'rgba(83,240,252,0.6)'; // High population color
            }

            return {
                pane: 'pane_number2_0', // Add to a specific pane
                opacity: 1,
                color: 'rgba(35,35,35,1.0)', // Border color
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, // Border weight
                fill: true,
                fillOpacity: 1,
                fillColor: fillColor, // Fill color based on population
                interactive: true, // Allow interactions
            };
        }

        // Create a pane for 'nomoi' features and add it to the map
        map.createPane('pane_number2_0');
        map.getPane('pane_number2_0').style.zIndex = 202;
        map.getPane('pane_number2_0').style['mix-blend-mode'] = 'normal';

        // Add 'number2' GeoJSON layer with styles and popups
        var layer_number2_0 = new L.geoJson(json_number2_0, {
            attribution: '',
            interactive: true,
            dataVar: 'json_number2_0',
            layerName: 'layer_number2_0',
            pane: 'pane_number2_0',
            onEachFeature: pop_number2_0, // Add popups
            style: style_number2_0, // Apply styling
        });

// Add the layer to the bounds group
bounds_group.addLayer(layer_number2_0);
// Function to handle the slider change event
document.getElementById('year-slider').addEventListener('input', function() {
    const year = this.value; // Get the current slider value (year)

    // Update the year label
    document.getElementById('year-label').textContent = year;

    // Check the value of the year and add or remove the layer
    if (year == 2011) {
        if (!map.hasLayer(layer_number2_0)) { // Check if the layer is not already on the map
            map.addLayer(layer_number2_0); // Add the layer to the map for 2011
        }
    } else {
        if (map.hasLayer(layer_number2_0)) { // Check if the layer is on the map
            map.removeLayer(layer_number2_0); // Remove the layer if it's not 2011
        }
    }
});

        // Add a layer control with tree structure for overlays
        var lay = L.control.layers.tree(null, overlaysTree, {
            collapsed: true, // Keep the control collapsed
        });
        lay.addTo(map); // Add the layer control to the map

        // Call setBounds to adjust the map bounds if necessary
        setBounds();
        </script>
<script>

        // Basemaps

        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        });

        var cartodark = L.tileLayer('https://a.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}@2x.png', {
            attribution: '&copy; CartoDark'
        }).addTo(map);

        var esri = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenTopoMap contributors'
        });
        
        var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '&copy; Esri'
        });

        L.control.layers({ "Carto Dark": cartodark, "OpenStreetMap": osm, "Esri Topo": esri, "Satellite": satellite }).addTo(map);


// Function to create popups for 'Fire' features with customized content

        function pop_Fire_0(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Type</th>\
                        <td class="visible-with-data" id="Type">' + (feature.properties['Type'] !== null ? autolinker.link(String(feature.properties['Type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Severity</th>\
                        <td class="visible-with-data" id="Severity">' + (feature.properties['Severity'] !== null ? autolinker.link(String(feature.properties['Severity']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">QR Code</th>\
                        <td class="visible-with-data" id="QR Code">' + 
                            (feature.properties['QR Code'] === '1' 
                            ? `<img src="images/qr-code1.png" width="144" height="144" 
         onclick="showImageOverlay('images/qr-code1.png')" 
         style="cursor: pointer;">`
                                : feature.properties['QR Code'] === '2' 
                                ? `<img src="images/qr-code2.png" width="144" height="144" 
         onclick="showImageOverlay('images/qr-code2.png')" 
         style="cursor: pointer;">`
                                : (feature.properties['QR Code'] === null || feature.properties['QR Code'] === '0' ||feature.properties['QR Code'] === '' || feature.properties['QR Code'] === undefined) 
                                    ? 'No QR Code available'
                                    : '') + 
                                    
                        '</td>\
                            </tr>\
    <tr>\
        <th scope="row">Radio</th>\
        <td class="visible-with-data" id="Radio">' + 
            (feature.properties['Radio'] === '1' 
    ? `<div style="position: relative; display: inline-block; text-align: center;">
           <img src="images/radio_player_1.png" style="width: 305px; height: 70px; border-radius: 7px; border: 2.3px solid #1b1d1f; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2), 0 6px 20px rgba(0, 0, 0, 0.19);">
           <div style="margin-top: 10px; font-size: 16px; font-weight: bold; color: #333; text-align: center;">
               Rebel 105.2
           </div>
           <audio controls class="audio"  style="position: absolute; bottom: 50px; left: 115px; transform: translateX(-50%); width: 70%; background: transparent; border: none; outline: none;">
    <source src="https://netradio.live24.gr/rebel1052" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>
       </div>`
    : feature.properties['Radio'] === '2' 
    ? `<div style="position: relative; display: inline-block; text-align: center;">
           <img src="images/radio_player_2.png" style="width: 305px; height: 70px; border-radius: 7px; border: 2.3px solid #ffffff; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2), 0 6px 20px rgba(0, 0, 0, 0.19);">
           <div style="margin-top: 10px; font-size: 16px; font-weight: bold; color: #333; text-align: center;">
               Easy 97.2
           </div>
           <audio controls controls class="audio-player-inverted" style="position: absolute; bottom: 50px; left: 115px; transform: translateX(-50%); width: 70%; background: transparent; border: none; outline: none;">
    <source src="https://easy972.live24.gr/easy972" type="audio/mpeg">
    Your browser does not support the audio element.
           </audio>
       </div>`
    : (feature.properties['Radio'] === null || feature.properties['Radio'] === '0' || feature.properties['Radio'] === '' || feature.properties['Radio'] === undefined) 
        ? 'No Radio available'
        : '') + 
        '</td>\
    </tr>\
</table>';
                
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
            });
            
        layer.bindPopup(popupContent, { 
            maxHeight: 400, // Set max height for the popup
            maxWidth: 400,  // Increase max width for the popup
            autoPan: true,  // Automatically pan the map if the popup overflows
        });
    }

        function style_Fire_0_0(feature) {
            switch(String(feature.properties['Severity'])) {
                case 'Low':
                    return {
                pane: 'pane_Fire_0',
                radius: 8.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(235,178,72,1.0)',
                interactive: true,
            }
                    break;
                case 'Medium':
                    return {
                pane: 'pane_Fire_0',
                radius: 16.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(220,109,69,1.0)',
                interactive: true,
            }
                    break;
                case 'High':
                    return {
                pane: 'pane_Fire_0',
                radius: 24.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(199,0,0,1.0)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Fire_0');
        map.getPane('pane_Fire_0').style.zIndex = 400;
        map.getPane('pane_Fire_0').style['mix-blend-mode'] = 'normal';
        var layer_Fire_0 = new L.geoJson(json_Fire_0, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Fire_0',
            layerName: 'layer_Fire_0',
            pane: 'pane_Fire_0',
            onEachFeature: pop_Fire_0,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_Fire_0_0(feature));
            },
        });
        bounds_group.addLayer(layer_Fire_0);
        map.addLayer(layer_Fire_0);

// Function to create popups for 'Photo' features with customized content

        function pop_Photo_0(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Type</th>\
                        <td class="visible-with-data" id="Type">' + (feature.properties['Type'] !== null ? autolinker.link(String(feature.properties['Type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Popularity</th>\
                        <td class="visible-with-data" id="Popularity">' + (feature.properties['Popularity'] !== null ? autolinker.link(String(feature.properties['Popularity']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Image</th>\
                        <td class="visible-with-data" id="image">' + 
                            (feature.properties['image'] === '1' 
                            ? `<img src="images/image1.png" width="256" height="144" 
         onclick="showImageOverlay('images/image1.png')" 
         style="cursor: pointer;">`
                                : feature.properties['image'] === '2' 
                                ? `<img src="images/image2.png" width="256" height="144" 
         onclick="showImageOverlay('images/image2.png')" 
         style="cursor: pointer;">`
                                : (feature.properties['image'] === null || feature.properties['image'] === '0' ||feature.properties['image'] === '' || feature.properties['image'] === undefined) 
                                    ? 'No image available'
                                    : '') + 
                        '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Video</th>\
                        <td class="visible-with-data" id="video" colspan="2">' + 
                            (feature.properties['video'] === '1' 
                                ? '<video width="256" height="144" controls>\
                                    <source src="videos/video1.mp4" type="video/mp4">\
                                    Your browser does not support the video tag.\
                                   </video>'
                                : feature.properties['video'] === '2' 
                                ? '<video width="256" height="144" controls>\
                                    <source src="videos/video2.mp4" type="video/mp4">\
                                    Your browser does not support the video tag.\
                                   </video>'
                                : (feature.properties['video'] === '0' || feature.properties['video'] === null ||feature.properties['video'] === '' || feature.properties['video'] === undefined) 
                                    ? 'No video available'
                                    : '') + 
                        '</td>\
                    </tr>\
                                        <tr>\
            <th scope="row">Model</th>\
            <td class="visible-with-data" id="model">' + 
                (feature.properties['model'] === '1' 
            ? `<model-viewer src="https://raw.githubusercontent.com/eftsev/3dmodels/main/model1/model1-opt.glb"
                            camera-controls 
                            auto-rotate
                            style="width: 256px; height: 144px;">
               </model-viewer>
               <button class="modern-button" onclick="showModelOverlay('https://raw.githubusercontent.com/eftsev/3dmodels/main/model1/model1-opt.glb')" 
                       style="margin-top: 10px; padding: 5px 10px; font-size: 14px; cursor: pointer;">
                   View 3D Model
               </button>`
            : (feature.properties['model'] === null || feature.properties['model'] === '0' || feature.properties['model'] === '' || feature.properties['model'] === undefined) 
                ? 'No 3D model available'
                : '') + 
            '</td>\
        </tr>\
    </table>';

    // Remove empty rows from the content (make sure this function works correctly)
    popupContent = removeEmptyRowsFromPopupContent(popupContent, feature);

    // Bind the popup to the layer
    layer.bindPopup(popupContent, { 
        maxHeight: 400, // Set max height for the popup
        maxWidth: 400,  // Set max width for the popup
        autoPan: true,  // Automatically pan the map if the popup overflows
    });

    // After the popup is opened, add additional classes or handle the popup further
    layer.on('popupopen', function(e) {
        addClassToPopupIfMedia(e.popup);  // Make sure to pass e.popup, not content
    });
}

        function style_Photo_0_0() {
            return {
                pane: 'pane_Photo_0',
        rotationAngle: 0.0,
        rotationOrigin: 'center center',
        icon: L.icon({
            iconUrl: 'markers/Photo_1.svg',
            iconSize: [22.800000000000008, 22.800000000000008]
        }),
                interactive: true,
            }
        }
        map.createPane('pane_Photo_0');
        map.getPane('pane_Photo_0').style.zIndex = 401;
        map.getPane('pane_Photo_0').style['mix-blend-mode'] = 'normal';
        var layer_Photo_0 = new L.geoJson(json_Photo_0, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Photo_0',
            layerName: 'layer_Photo_0',
            pane: 'pane_Photo_0',
            onEachFeature: pop_Photo_0,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.marker(latlng, style_Photo_0_0(feature));
            },
        });
        bounds_group.addLayer(layer_Photo_0);
        map.addLayer(layer_Photo_0);
        setBounds();

// Function to set the layer order
function setLayerOrder() {
    // Set the zIndex values for the panes in the desired order
    map.getPane('pane_Fire_0').style.zIndex = 500; // Fire_0 on top
    map.getPane('pane_Photo_0').style.zIndex = 600; // Photo_0 below Fire_0
    map.getPane('pane_nomoi_1').style.zIndex = 400; // nomoi_1 below Photo_0
    map.getPane('pane_number2_0').style.zIndex = 400; // number2_0 at the bottom
}

// Call the function to set the layer order
setLayerOrder();
</script>
    </body>
</html>